<!doctype html>
<html lang="id" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pretest Seni Musik Semester II</title>

  <!-- SDK -->
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    * { font-family: 'Poppins', sans-serif; box-sizing: border-box; }
    .game-container { background: linear-gradient(135deg, #667eea, #764ba2); min-height: 100%; }
    .card { background: rgba(255,255,255,.95); backdrop-filter: blur(10px); border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,.3); }
    .note-icon { animation: float 3s ease-in-out infinite; }
    @keyframes float { 0%,100%{transform:translateY(0)}50%{transform:translateY(-20px)} }
    .option-btn { transition:.3s; }
    .option-btn:hover { transform: scale(1.05); }
    .option-btn.correct { background:#10b981!important;color:white!important }
    .option-btn.wrong { background:#ef4444!important;color:white!important }
    .score-badge { background: linear-gradient(135deg,#f093fb,#f5576c); color:white; padding:8px 20px; border-radius:30px; font-weight:600 }
    .progress-bar { height:8px; background:rgba(255,255,255,.3); border-radius:10px; overflow:hidden }
    .progress-fill { height:100%; background:linear-gradient(90deg,#fbbf24,#f59e0b); transition:.5s }
    .tombol-mulai { background: linear-gradient(135deg,#38bdf8,#2563eb); }
  </style>
</head>

<body class="h-full">
<div id="app" class="game-container w-full h-full"></div>

<script>
/* ================= CONFIG ================= */
const GAS_URL = "https://script.google.com/macros/s/AKfycbyU-8L2oS1ybXzXf6HmukHU9atg9TzjPebG8Y3fRdEBw_SGTEp3KcDe9ayCasUDb6uu/exec";

const defaultConfig = {
  judul_game: "<b>Pretest</b><br>Seni Musik Semester II",
  subtitle_game: "SMA Islam Al Azhar 16 Semarang",
  instruksi_game: "Jawablah dengan tepat!",
  tombol_mulai: "Mulai Gaskeun!"
};

/* ================= STATE ================= */
let currentScore = 0;
let currentQuestion = 0;
let playerName = "";
let playerClass = "";
let startTime = null;

/* ================= QUESTIONS ================= */
const questions = [
  { q:"Berapa jumlah nada dalam tangga nada mayor?", o:["5","6","7","8"], c:2 },
  { q:"Pola interval tangga nada mayor?", o:["1-1-½-1-1-1-½","1-½-1-1-½-1-1","½-1-1-½-1-1-1","1-1-1-½-1-1-½"], c:0 },
  { q:"Tangga nada C Mayor tidak memiliki tanda?", o:["Kres","Mol","Keduanya","Salah"], c:2 }
];

/* ================= UI ================= */
function renderWelcome() {
  return `
  <div class="flex items-center justify-center min-h-full p-6">
    <div class="card p-8 max-w-md w-full text-center">
      <img src="https://raw.githubusercontent.com/pakfab/aaaassseeetttt/a88e291dd46aeff08e4332b6b1ce8dc4dc9acb0b/logosma.png" class="mx-auto w-24 mb-4"/>
      <h1 class="text-3xl font-bold mb-2">${defaultConfig.judul_game}</h1>
      <p class="text-gray-600 mb-4">${defaultConfig.subtitle_game}</p>
      <input id="playerName" placeholder="Nama" class="w-full p-3 border rounded mb-3">
      <input id="playerClass" placeholder="Kelas" class="w-full p-3 border rounded mb-4">
      <button onclick="startGame()" class="tombol-mulai w-full py-3 text-white font-bold rounded">${defaultConfig.tombol_mulai}</button>
    </div>
  </div>`;
}

function renderQuestion() {
  const q = questions[currentQuestion];
  return `
  <div class="flex items-center justify-center min-h-full p-6">
    <div class="card p-8 max-w-xl w-full">
      <div class="score-badge mb-4">Skor: ${currentScore}</div>
      <h2 class="text-xl font-bold mb-6">${q.q}</h2>
      ${q.o.map((x,i)=>`
        <button onclick="answer(${i})" class="option-btn w-full mb-3 p-4 border rounded">${x}</button>
      `).join("")}
    </div>
  </div>`;
}

function renderResult() {
  return `
  <div class="flex items-center justify-center min-h-full p-6">
    <div class="card p-8 max-w-md w-full text-center">
      <h1 class="text-3xl font-bold mb-2">Selesai</h1>
      <p>Skor: ${currentScore}</p>
      <div id="saveStatus" class="mt-4"></div>
    </div>
  </div>`;
}

/* ================= LOGIC ================= */
function startGame() {
  playerName = document.getElementById("playerName").value.trim();
  playerClass = document.getElementById("playerClass").value.trim();
  if (!playerName || !playerClass) return alert("Isi nama & kelas");
  startTime = new Date();
  render();
}

function answer(i) {
  if (i === questions[currentQuestion].c) currentScore++;
  currentQuestion++;
  currentQuestion < questions.length ? render() : finish();
}

function finish() {
  document.getElementById("app").innerHTML = renderResult();
  saveResult();
}

function saveResult() {
  const status = document.getElementById("saveStatus");
  const form = new FormData();
  form.append("nama", playerName);
  form.append("kelas", playerClass);
  form.append("nilai", currentScore);
  form.append("waktu", Math.floor((Date.now()-startTime)/1000)+" detik");

  fetch(GAS_URL,{ method:"POST", body:form })
    .then(()=> status.innerHTML="✅ Nilai tersimpan")
    .catch(()=> status.innerHTML="❌ Gagal menyimpan");
}

function render() {
  document.getElementById("app").innerHTML =
    !playerName ? renderWelcome() :
    currentQuestion < questions.length ? renderQuestion() :
    renderResult();
}

render();
</script>
</body>
</html>
